---
title: "Emacs"
editor:
  markdown:
    wrap: sentence
    canonical: true
---

# Using Eglot

Add the following to your `init.el`:

``` elisp
(use-package eglot
   :ensure t
   :config
   (require 'ess-site)
   (add-hook 'ess-r-mode-hook 'eglot-ensure) ; start lsp in ess-r-mode
   (add-to-list 'eglot-server-programs '(ess-r-mode . ("air" "language-server")))

   ;; format on save--optional
   (defun my-eglot-format-on-save ()
     "Formats buffer with Eglot on save, but only for specific modes."
     (when (member major-mode '(ess-r-mode))
       (eglot-format-buffer)))
    (add-hook 'after-save-hook 'my-eglot-format-on-save)  
    )
```
You can also run `M-x eglot-format` to format the current buffer or selection.

# Using LSP-mode

Add the following to your `init.el`:

```elisp
(use-package lsp-mode
  :ensure t
  :config
  (add-to-list 'lsp-disabled-clients 'lsp-r) ; disable languagesever entirely
  (lsp-register-client
   (make-lsp-client
    :new-connection (lsp-stdio-connection '("air" "language-server"))
    :major-modes '(ess-r-mode)
    :server-id 'lsp-r-air)
    )

   ;;format on save--optional
   (add-hook 'ess-r-mode-hook #'lsp-deferred)
   (defun ess-lsp-format-on-save ()
     "Formats buffer on save, but only for specific modes."
     (when (member major-mode '(ess-r-mode))
       (lsp-format-buffer)))
   (add-hook 'after-save-hook 'ess-lsp-format-on-save)  
   )
```
You can also run `M-x lsp-format-buffer` to format the current buffer or `lsp-format-region` to format the current selection.

# Known Issues

- Attempting to format selection when multiple lines are selected seems not to be working, but selecting part or all a line in a multi-line expression will format that entire expression. This isssue occurs regardless of whether Air is used with Eglot or LSP-mode.
